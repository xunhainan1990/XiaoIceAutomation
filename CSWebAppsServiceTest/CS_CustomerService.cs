using Microsoft.VisualStudio.TestTools.UnitTesting;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace CSWebAppsServiceTest
{
    [TestClass]
    public class CS_CustomerService
    {
        //String domainUrl = "http://cs-customerservice-int.cloudapp.net/Api/CustomerService/ReplyV2";
        string domainUrl = "http://cs-customerservice-prod.cloudapp.net/Api/CustomerService/ReplyV2";
        //string contenttemplate = "{'Config':{'Partner':'PartnerID15','SpecialIndex':14,'ComponentWhiteList':null,'RandomChitChatIndex':''},'MasterPhoneNumber':'o9CrYwZSGO_bpVBRbvE3K1yo4uMw','FromUserPhoneNumber':'o9CrYwZSGO_bpVBRbvE3K1yo4uMw','IsWhiteListUser':false,'Market':null,'RoomId':null,'UserMessage':'{1}','RawUserMessage':'{1}','MessageId':'7384a791186cde009467e8cecbcbcfc0','IsToMe':true,'XiaobingNickName':'小冰','Action':0,'ActorId':null,'RecipientIds':null,'AdditionalInfo':null,'Dialect':0,'IsCustomerServiceQuery':false,'IsSocialQnAQuery':false,'MetaData':{'WeChatAppId':'wx81d59146963e638d','CSEnabledSkills':'1;2;3;5;6;','CSHumanIntelligenceAuthenticationEndpointUrl':'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx81d59146963e638d&redirect_uri=http%3A%2F%2Fcsint.trafficmanager.cn%2FWebApps%2FHiChatAuth&response_type=code&scope=snsapi_userinfo&state={0}#wechat_redirect','VerifiedAccount':'true','CSTimeTag':'636168017857418239','_UserProfile_City':'\\'北京\\''},'UserMessageWordBreak':'','FromUserInfo':{'NickName':null,'Country':null,'Province':null,'City':null},'MasterUserInfo':{'NickName':null,'Country':null,'Province':null,'City':null},'TypedDefaultContextCache':null,'SessionCache':null,'RoomSessionCache':null,'ReformedQuery':null,'TraceId':'7384a791186cde009467e8cecbcbcfc0','FromPartnerId':25}";
        string contenttemplate = "{'Config':{'Partner':'PartnerID15','SpecialIndex':14,'ComponentWhiteList':null,'RandomChitChatIndex':''},'MasterPhoneNumber':'o9CrYwZSGO_bpVBRbvE3K1yo4uMw','FromUserPhoneNumber':'o9CrYwZSGO_bpVBRbvE3K1yo4uMw','IsWhiteListUser':false,'RoomId':null,'UserMessage':'{1}','RawUserMessage':'{1}','MessageId':'7384a791186cde00a0d3b94d7ca34230','IsToMe':true,'XiaobingNickName':'小冰','FromUserInfo':{'NickName':null,'Country':null,'Province':null,'City':null},'SessionCache':null,'TraceId':'7384a791186cde00a0d3b94d7ca34230','FromPartnerId':25,'MetaData':{'WeChatAppId':'{2}','CSEnabledSkills':'1;2;3;5;6;7;','CSHumanIntelligenceAuthenticationEndpointUrl':'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx81d59146963e638d&redirect_uri=http%3A%2F%2Fcsint.trafficmanager.cn%2FWebApps%2FHiChatAuth&response_type=code&scope=snsapi_userinfo&state={0}#wechat_redirect','VerifiedAccount':'true','CSTimeTag':'636179077914731186','_UserProfile_City':'\\'北京\\''}} ";
        string LongContentTemplate = "{\"Config\":{\"Partner\":\"PartnerID15\",\"SpecialIndex\":14,\"ComponentWhiteList\":null,\"RandomChitChatIndex\":\"\"},\"MasterPhoneNumber\":\"o9CrYwZSGO_bpVBRbvE3K1yo4uMw\",\"FromUserPhoneNumber\":\"o9CrYwZSGO_bpVBRbvE3K1yo4uMw\",\"IsWhiteListUser\":false,\"RoomId\":null,\"UserMessage\":\"魔兽\",\"RawUserMessage\":\"魔兽\",\"MessageId\":\"7384a791186cde009bc1aa8a140fea02\",\"IsToMe\":true,\"XiaobingNickName\":\"小冰\",\"FromUserInfo\":{\"NickName\":null,\"Country\":null,\"Province\":null,\"City\":null},\"SessionCache\":{\"SessionId\":\"520ec99b9aba4a1cb27923de27ce1841\",\"CurrentRound\":3,\"LastReply\":\"危难之际，刘备一句话惊天动地，至今仍被反复引用####http://mp.weixin.qq.com/s?__biz=MzI1MjE2OTQ2MA==&mid=100010110&idx=1&sn=1df62848806668e5ca724116465c3b79#rd####wx81d59146963e638d####7384a791186cde009b3bdd2ad3ec78b0####CSCardTrigger%\",\"LastQuestion\":\"刘备\",\"IsImageLastReply\":false,\"LastReplyService\":\"CustomerService\",\"UserStatusWindowSize\":-2,\"DuplicateQuestionRounds\":1,\"Rounds\":[{\"Q\":\"魔镜魔镜\",\"A\":\"KISS ME的好我用了\"},{\"Q\":\"刘备\",\"A\":\"危难之际，刘备一句话惊天动地，至今仍被反复引用####http://mp.weixin.qq.com/s?__biz=MzI1MjE2OTQ2MA==&mid=100010110&idx=1&sn=1df62848806668e5ca724116465c3b79#rd####wx81d59146963e638d####7384a791186cde009b3bdd2ad3ec78b0####CSCardTrigger%\"}],\"LastUpdateTimeUtc\":\"2016-12-20T14:53:18.8968149Z\",\"Metadata\":{\"RankFactor\":\"0\",\"TopicChatContextNew\":\"[{\\\"LastReply\\\":\\\"\\\",\\\"Properties\\\":{},\\\"Start\\\":2,\\\"ResponseTime\\\":\\\"2016-12-20T22:53:18\\\",\\\"Topic\\\":\\\"\\\",\\\"Last\\\":2,\\\"Domain\\\":\\\"\\\"}]\",\"CSCardTriggerControlSessionKey\":\"\",\"ContentQnAServiceV2SessionKey\":\"2\",\"DuplicateAbuse_Rounds\":\"1\",\"DuplicateAdult_Rounds\":\"1\",\"DuplicatePolitical_Rounds\":\"1\",\"DuplicateQuestion_Rounds\":\"1\",\"DuplicateQuestion_Status\":\"1\",\"Parrot_Rounds\":\"1\"},\"SessionHistory\":[\"{\\\"Text\\\":\\\"魔镜魔镜\\\",\\\"Metadata\\\":{\\\"WeChatAppId\\\":\\\"wx81d59146963e638d\\\",\\\"CSEnabledSkills\\\":\\\"1;2;3;5;6;7;\\\",\\\"CSHumanIntelligenceAuthenticationEndpointUrl\\\":\\\"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx81d59146963e638d&redirect_uri=http%3A%2F%2Fcsint.trafficmanager.cn%2FWebApps%2FHiChatAuth&response_type=code&scope=snsapi_userinfo&state={0}#wechat_redirect\\\",\\\"VerifiedAccount\\\":\\\"true\\\",\\\"CSTimeTag\\\":\\\"636178422263358195\\\",\\\"Domain\\\":\\\"movie\\\",\\\"Topic\\\":\\\"魔镜魔镜\\\",\\\"Properties\\\":\\\"{\\\\\\\"trigger\\\\\\\": \\\\\\\"魔镜魔镜\\\\\\\", \\\\\\\"candidates\\\\\\\": [{\\\\\\\"co\\\\\\\": \\\\\\\"1\\\\\\\", \\\\\\\"ty\\\\\\\": \\\\\\\"\\\\\\\", \\\\\\\"tr\\\\\\\": \\\\\\\"魔镜魔镜\\\\\\\", \\\\\\\"to\\\\\\\": \\\\\\\"魔镜魔镜\\\\\\\"}]}\\\",\\\"speaker\\\":\\\"o9CrYwZSGO_bpVBRbvE3K1yo4uMw\\\"},\\\"ContentType\\\":1}\",\"{\\\"Text\\\":\\\"KISS ME的好我用了\\\",\\\"Metadata\\\":{\\\"L1Score\\\":\\\"8.986585\\\",\\\"L2Score\\\":\\\"2.8498113155365\\\",\\\"SourceTag\\\":\\\"21\\\",\\\"TriggeredService\\\":\\\"RandomChitChatService\\\",\\\"ServiceLevelLog\\\":\\\"{\\\\\\\"Service\\\\\\\":\\\\\\\"RandomChitChatService\\\\\\\",\\\\\\\"Log\\\\\\\":\\\\\\\"{\\\\\\\\\\\\\\\"Tag\\\\\\\\\\\\\\\":42,\\\\\\\\\\\\\\\"UnderContext\\\\\\\\\\\\\\\":false,\\\\\\\\\\\\\\\"ContextInfo\\\\\\\\\\\\\\\":{\\\\\\\\\\\\\\\"PostProcessThreshold\\\\\\\\\\\\\\\":0.0,\\\\\\\\\\\\\\\"UseContext\\\\\\\\\\\\\\\":false,\\\\\\\\\\\\\\\"ContextContinusScore\\\\\\\\\\\\\\\":0.0,\\\\\\\\\\\\\\\"QueryReformScore\\\\\\\\\\\\\\\":0.0,\\\\\\\\\\\\\\\"TopQueryScore\\\\\\\\\\\\\\\":0.0,\\\\\\\\\\\\\\\"Query\\\\\\\\\\\\\\\":null,\\\\\\\\\\\\\\\"Query4Retrieval\\\\\\\\\\\\\\\":null,\\\\\\\\\\\\\\\"WeightedQuery4Retrieval\\\\\\\\\\\\\\\":null,\\\\\\\\\\\\\\\"ContextKeyWords\\\\\\\\\\\\\\\":null,\\\\\\\\\\\\\\\"EmotionVerticalTags\\\\\\\\\\\\\\\":null,\\\\\\\\\\\\\\\"RawQuery\\\\\\\\\\\\\\\":null,\\\\\\\\\\\\\\\"RawQueryTerms\\\\\\\\\\\\\\\":null,\\\\\\\\\\\\\\\"Session\\\\\\\\\\\\\\\":null,\\\\\\\\\\\\\\\"SessionTermsList\\\\\\\\\\\\\\\":null,\\\\\\\\\\\\\\\"MergeQ\\\\\\\\\\\\\\\":false,\\\\\\\\\\\\\\\"MergeA\\\\\\\\\\\\\\\":false,\\\\\\\\\\\\\\\"DetectionFeaInfoDict\\\\\\\\\\\\\\\":null}}\\\\\\\"}\\\",\\\"AnswerFeed\\\":\\\"RandomChitChatService\\\"},\\\"ContentType\\\":1}\",\"{\\\"Text\\\":\\\"[movie|魔镜魔镜|{\\\\\\\"trigger\\\\\\\": \\\\\\\"魔镜魔镜\\\\\\\", \\\\\\\"candidates\\\\\\\": [{\\\\\\\"co\\\\\\\": \\\\\\\"1\\\\\\\", \\\\\\\"ty\\\\\\\": \\\\\\\"\\\\\\\", \\\\\\\"tr\\\\\\\": \\\\\\\"魔镜魔镜\\\\\\\", \\\\\\\"to\\\\\\\": \\\\\\\"魔镜魔镜\\\\\\\"}]}]\\\",\\\"Metadata\\\":{\\\"AnswerFeed\\\":\\\"TopicOut\\\"},\\\"ContentType\\\":1}\",\"{\\\"Text\\\":\\\"刘备\\\",\\\"Metadata\\\":{\\\"WeChatAppId\\\":\\\"wx81d59146963e638d\\\",\\\"CSEnabledSkills\\\":\\\"1;2;3;5;6;7;\\\",\\\"CSHumanIntelligenceAuthenticationEndpointUrl\\\":\\\"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx81d59146963e638d&redirect_uri=http%3A%2F%2Fcsint.trafficmanager.cn%2FWebApps%2FHiChatAuth&response_type=code&scope=snsapi_userinfo&state={0}#wechat_redirect\\\",\\\"VerifiedAccount\\\":\\\"true\\\",\\\"CSTimeTag\\\":\\\"636178423982405746\\\",\\\"Domain\\\":\\\"\\\",\\\"Topic\\\":\\\"\\\",\\\"Properties\\\":\\\"{}\\\",\\\"speaker\\\":\\\"o9CrYwZSGO_bpVBRbvE3K1yo4uMw\\\"},\\\"ContentType\\\":1}\",\"{\\\"Text\\\":\\\"危难之际，刘备一句话惊天动地，至今仍被反复引用####http://mp.weixin.qq.com/s?__biz=MzI1MjE2OTQ2MA==&mid=100010110&idx=1&sn=1df62848806668e5ca724116465c3b79#rd####wx81d59146963e638d####7384a791186cde009b3bdd2ad3ec78b0####CSCardTrigger%\\\",\\\"Metadata\\\":{\\\"card\\\":\\\"{\\\\\\\"CardID\\\\\\\":0,\\\\\\\"Partner\\\\\\\":null,\\\\\\\"CreateTime\\\\\\\":0,\\\\\\\"ArticleCount\\\\\\\":1,\\\\\\\"Articles\\\\\\\":[{\\\\\\\"ArticleID\\\\\\\":0,\\\\\\\"Partner\\\\\\\":null,\\\\\\\"Title\\\\\\\":\\\\\\\"危难之际，刘备一句话惊天动地，至今仍被反复引用\\\\\\\",\\\\\\\"Author\\\\\\\":null,\\\\\\\"ImageUrl\\\\\\\":\\\\\\\"http://mmbiz.qpic.cn/mmbiz_jpg/7axrMgicnAYKvAicpTUJnQJZ5DiasgeInLBjOZqSuAVuWiaVjIQAZXYf8hP1zWzjgMGrK7BpwurrUibQ41ftZEOtRjA/0?wx_fmt=jpeg\\\\\\\",\\\\\\\"WechatImageUrl\\\\\\\":null,\\\\\\\"Abstract\\\\\\\":\\\\\\\"　《三国演义》塑造了一个仁义的帝王形象刘备，单讲德操，确实有过人之处，不过人心不足，总觉得刘备仁义有余，威武\\\\\\\",\\\\\\\"Body\\\\\\\":null,\\\\\\\"SourceUrl\\\\\\\":\\\\\\\"http://cslog.trafficmanager.cn/Home/Log?content=rN1it8exoCv24f9rqOHURJPU1VJYVzAj%2fNcLpPxwPwyQsviLf%2fo9hUtmVVTV08VH0IH3FUr88EcflgworgkmHkRd7gk4MRlWBi0suqwrfBusirQGfjg2o3MNnXiVj6tGB1zFNT3VVMLz%2blqlgxneGkmz%2fABTKSe6C86H95dgv3QUGTb3T%2bFB%2bdNZTTnGrbgeRqSMHyRW35c3KpyPaV3%2fz7FflVnn5lmgrEcH4Aac5KSMkqazAPVEk7R1tQUJtkjel5dIL7%2fgF0STt2jWIODES9yjke2ZRHkrWYak%2fdyLvNpokk6Hk0NFBfF98%2bBi9ZrSf1oLyAp6%2bnRFpINGj%2bSrpNDEmLMUYn6yb27vIGyyWjF9L1wyBk89TUHI3wtX9b0N3PaELC%2brPsBFLMg2%2b%2fe6hfb1gaMkDknnlNH%2beeoMAMYfmOnvrme%2f9HbQLIyG4mi2RVgZ8xdtqWVV%2fRQqF%2b0yLN4sr0OXcNi8uKzxObVtzWd2SMpeJV%2fveKitnRiZSFBh\\\\\\\",\\\\\\\"Rank\\\\\\\":0,\\\\\\\"CreateTime\\\\\\\":0,\\\\\\\"WechatArticleUrl\\\\\\\":\\\\\\\"http://mp.weixin.qq.com/s?__biz=MzI1MjE2OTQ2MA==&mid=100010110&idx=1&sn=1df62848806668e5ca724116465c3b79#rd\\\\\\\"}]}\\\",\\\"AnswerFeed\\\":\\\"CustomerService\\\"},\\\"ContentType\\\":1}\",\"{\\\"Text\\\":\\\"蜀 将 何在\\\",\\\"Metadata\\\":{\\\"AnswerFeed\\\":\\\"RandomChitChatService\\\"},\\\"ContentType\\\":1}\"]},\"TraceId\":\"7384a791186cde009bc1aa8a140fea02\",\"FromPartnerId\":25,\"MetaData\":{\"WeChatAppId\":\"wx81d59146963e638d\",\"CSEnabledSkills\":\"1;2;3;5;6;7;\",\"CSHumanIntelligenceAuthenticationEndpointUrl\":\"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx81d59146963e638d&redirect_uri=http%3A%2F%2Fcsint.trafficmanager.cn%2FWebApps%2FHiChatAuth&response_type=code&scope=snsapi_userinfo&state={0}#wechat_redirect\",\"VerifiedAccount\":\"true\",\"CSTimeTag\":\"636178424368819101\",\"_UserProfile_City\":\"\\\"北京\\\"\"}}";
        [TestMethod]
        [TestProperty("description", "魔兽")]
        public void Moshou()
        {
            String Content1 = LongContentTemplate.Replace("{1}", "魔兽");
            string Response = HTTPUtility.GetResponse(domainUrl, Content1);
            Assert.IsTrue(HTTPUtility.GetSourceUrl(Response));
            Console.WriteLine(HTTPUtility.timeSpan.TotalMilliseconds + " ms");
        }

        [TestMethod]
        [TestProperty("description", "危难之际，刘备一句话惊天动地，至今仍被反复引用")]
        public void LiuBeiLongTriggerTest()
        {
            String Content1 = contenttemplate.Replace("{1}", "危难之际，刘备一句话惊天动地，至今仍被反复引用").Replace("{2}", "wx81d59146963e638d");
            string Response = HTTPUtility.GetResponse(domainUrl, Content1);
            Assert.IsTrue(HTTPUtility.GetSourceUrl(Response));
            Console.WriteLine(HTTPUtility.timeSpan.TotalMilliseconds + " ms");
        }


        [TestMethod]
        [TestProperty("description", "刘备")]
        public void LiuBeiTriggerTest()
        {
            String Content1 = contenttemplate.Replace("{1}", "刘备").Replace("{2}", "wx81d59146963e638d");
            string Response = HTTPUtility.GetResponse(domainUrl, Content1);
            Assert.IsTrue(HTTPUtility.GetSourceUrl(Response));
            Console.WriteLine(HTTPUtility.timeSpan.TotalMilliseconds + " ms");
        }

        [TestMethod]
        [TestProperty("description", "求婚")]
        public void Propose()
        {
            String Content1 = contenttemplate.Replace("{1}", "求婚").Replace("{2}", "wx431d7a5c91fac96d");
            string Response = HTTPUtility.GetResponse(domainUrl, Content1);
            Assert.IsTrue(HTTPUtility.GetSourceUrl(Response));
            Console.WriteLine(HTTPUtility.timeSpan.TotalMilliseconds + " ms");
        }
    }
}

